<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous">

    <link rel="stylesheet" href="/static/css/style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>
  </head>
  <body>
   <!-- Button trigger modal -->


<!-- Modal -->
<div class="modal fade" id="staticBackdrop" data-backdrop="static" data-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="staticBackdropLabel">Add New Property</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
    <label> Property_Name: </label>
        <input type="text" value="" id="p_name" class="pop_in"  name="p_name"required><br><br>
        <label> Address: </label>
        <input type="text" value="" id="address" class="pop_in"style="margin-left: 3.3em;"  name="address"required><br><br>
        <label> Location: </label>
        <input type="text" value="" id="location" class="pop_in" style="margin-left: 3.1em;" name="location"required><br><br>
        <label> unit_name: </label>
        <input type="text" value="" id="u_name" class="pop_in" style="margin-left: 3.1em;" name="u_name"required><br>
        <label> rent_cost: </label>
        <input type="text" value="" id="rent" class="pop_in" style="margin-left: 3.1em;" name="rent"required><br>
        <label> Type: </label>
        <select id="type" class="pop_in" style="margin-left: 3.1em;" name="type"required>
          <option value=1>1</option>
          <option value=2>2</option>
          <option value=3>3</option>
          <option value=4>4</option>
        </select>

      </div>
      <div class="modal-footer"> 
        <button type="button"  class="add_experimental_card btn btn-primary"id="add_prop_main">Add</button>
      </div>
    </div>
  </div>
</div> 
{% for i in property %}
<div class="modal fade" id="staticBackdropview" data-backdrop="static" data-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="staticBackdropLabel">Property Details</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
    <label> Property_Name: </label>
        <input type="text" value="{{i.name}}" id="p_name" class="pop_in"  name="p_name"><br><br>
        <input type="text" value="{{i.id}}" id="p_id" class="pop_in"  name="p_id"hidden>
        <label> Address: </label>
        <input type="text" value="{{i.address}}" id="address" class="pop_in"style="margin-left: 3.3em;"  name="address"><br><br>
        <label> Location: </label>
        <input type="text" value="{{i.location}}" id="location" class="pop_in" style="margin-left: 3.1em;" name="location"><br><br>
        <label> Unit_name: </label>
        {% for j in unit %}
        <input type="text" value="{{j.unit_name}}" id="u_name" class="pop_in" style="margin-left: 3.1em;" name="u_name"><br>
        <label> type: </label>
        <input type="text" value="{{j.rent_cost}}" id="rent" class="pop_in" style="margin-left: 3.1em;" name="rent"><br>
        <label> rent_cost: </label>
        <input type="text" value="{{j.type}}" id="type" class="pop_in" style="margin-left: 3.1em;" name="type"><br>
          {% endfor %}
      </div>
      <div class="modal-footer"> 
        
        <button type="button"  class="add_experimental_card btn btn-primary"id="add_prop">Add</button>
      </div>
    </div>
  </div>
</div> 
{% endfor %}
<!-- model  end  -->
<div class="modal fade" id="traditional_m" data-backdrop="static" data-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="staticBackdropLabel">Add New Tenant</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form id ="tenant_form"method ="post">
         {% csrf_token %}
        <label> Tenant_Name: </label>
        <input type="text" value="" id="t_name" class="pop_in"  name="t_name"style="margin-left: 6.5em;"required><br><br>
        <label> contact_number: </label>
        <input type="text" value="" id="c_num" class="pop_in"style="margin-left: 5.3em;"  name="c_num"required><br><br>
        <label> document_proof: </label>
        <input type="file" value="" id="doc" class="pop_in" style="margin-left: 5.1em;" name="doc"required><br><br>
        <label> agreement_end_date: </label>
        <input type="date" value="" id="agre_end_date" class="pop_in" style="margin-left: 3.1em;" name="agre_end_date"required><br><br>
        <label> monthly_rent_date: </label>
        <input type="date" value="" id="mon_rent_date" class="pop_in" style="margin-left: 4.1em;" name="mon_rent_date"required><br><br>
        
        <label> Assign property: </label>
        <select id="as_prop" class="pop_in" style="margin-left: 4.1em;" name="as_prop">
          {% for i in property %}
          <option value="{{i.name}}">{{i.name}}</option>
          {% endfor %}
        </select>
        
      </div>
      <div class="modal-footer"> 
        <input type="submit" value="Add" class="add_traditional_card btn btn-primary">
      </form>
      </div>
    </div>
  </div>
</div> 
<!-- model  end  -->
<!-- Modal -->




<!-- Modal -->
<div class="modal   fade" id="chart" data-backdrop="static" data-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id=" ">Graph</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
     <canvas id="myChart" style="width:100%; max-height:300px;"></canvas>
  </div> 
       
      <!--div class="modal-footer"> 
        <button type="button"  class="btn btn-primary">Save</button>
      </div-->
    </div>
  </div>
</div> 
<!-- model  end  -->
<div class="modal   fade" id="chart1" data-backdrop="static" data-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id=" ">Graph</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
     <canvas id="myChart1" style="width:100%; max-height:300px;"></canvas>
  </div> 
       
      <!--div class="modal-footer"> 
        <button type="button"  class="btn btn-primary">Save</button>
      </div-->
    </div>
  </div>
</div> 
<!-- model  end  -->

 
<div class="container">
 <div id="container-1">
 <div class="mt-4 mb-4 d-canvas">
    <ul class="nav nav-tabs ">
      <!-- add data-toggle attribute to the anchors -->
      <li class="active"><a data-toggle="tab" href="#experimental">Properties</a></li>
      <li><a data-toggle="tab" href="#traditional">Tenants</a></li>  
       
    </ul>
  <!-- <p class="m-0 new_text" data-toggle="modal" data-target="#staticBackdrop">
  + New Tab</p> -->
  
  </div>
      <div class="tab-content">
      
      <div id="experimental" class="tab-pane  in active">
        
  <div class="text-center btn--m">
  <p class="m-0 new_text " data-toggle="modal"id="show_popup">
  + New Property</p></br>
  </div>
   <div class="row mt-2 main-content expirimental_c">
           {% for data in property %}
           <div class="col-md-4 mb-4 main_item ">
    <div class="tab-content-mn">
    <div class="dropdown"> 
       <i class="pl-1 font12 fa fa-ellipsis-v more_v " data-toggle="dropdown" aria-expanded="false"></i>
       <ul class="dropdown-menu " aria-labelledby="navbarDropdownMenuLink"> 
      <li class="dropdown-submenu"><a class="dropdown-item edit_field"id="view_prop" href="#">View</a>
           
          </li>
          <li><a class="dropdown-item edit_field" href="#" id="prop_edit"data-target="#staticBackdropview"data-toggle="modal">Edit</a></li>
          <li><a class="dropdown-item edit_field close_element" href="#"id="del_prop" >Delete</a></li>
          
        </ul> 
    </div> 
    <a href="#">
    <div class="tab-content-inn">
      <div class="content-img"><a href="#"><p class="edit_p"><input type="text" disabled class="border-0 text-center" value="{{data.name}}"></p></a></div>
        <input type="hidden" name="fieldidmain" id="fieldidmain" value="{{data.id}}">
      <input type="hidden" name="fieldtype" id="fieldtype" value="Experimental">
      <div class="d-grid d-right">
      <div class="btn_item">
        {% for data1 in data.paramlist %}
        <div class="hidden_edit" id="square">
      <i class="pl-1 font12 fa fa-edit fa-btn-edit" ></i>
      <i class="pl-1 font12 fa fa-trash icon-delete"onclick="deleteparam(this)" ></i> 
      <button type="button"  class="edit_btn btn btn-sm btn-outline-secondary"   onclick="minmax(this)"><input type="text"   class="border-0 text-center" value="{{data1.parameter_name}}" style="width: 85px;"  onclick="minmax(this)">
      </button>
      </div>  

         {% endfor %} 
      
      </div> 
      
      </div>
    </div>
  
    </div>
  </a>
    </div>
            {% endfor %} 
    </div>
      </div>
    </a> 
      <div id="traditional" class="tab-pane fade">
       <div class="text-center btn--m">
  <p class="m-0 new_text  "  data-toggle="modal"id="show_popup1">
  + New  Tenant</p>
  </div>
        <div class="row mt-2 main-content traditional_c">
    
     {% for data in tenant %}
           <div class="col-md-4 mb-4 main_item ">
    <div class="tab-content-mn">
    <div class="dropdown"> 
       <i class="pl-1 font12 fa fa-ellipsis-v more_v " data-toggle="dropdown" aria-expanded="false"></i>
       <ul class="dropdown-menu " aria-labelledby="navbarDropdownMenuLink"> 
      <li class="dropdown-submenu"><a class="dropdown-item dropdown-toggle" href="#"id="view_ten"=>View</a>
           
          </li>
          <li><a class="dropdown-item edit_field" href="#" id="ten_edit">Rename</a></li>
          <li><a class="dropdown-item edit_field close_element" href="#" >Delete</a></li>
          
        </ul> 
    </div> 
     
    <div class="tab-content-inn">
      <div class="content-img"><p class="edit_p"><input type="text" disabled class="border-0 text-center" value="{{data.name}}"></p></div>
      <input type="hidden" name="fieldidmain" id="fieldidmainten" value="{{data.id}}">
       <input type="hidden" name="fieldtype" id="fieldtype" value="Traditional">
      <div class="d-grid d-right">
      <div class="btn_item">
        {% for data1 in  data.paramlist %}
        <div class="hidden_edit" id="square">
      <i class="pl-1 font12 fa fa-edit fa-btn-edit" ></i>
      <i class="pl-1 font12 fa fa-trash icon-delete" onclick="deleteparam(this)"></i> 
      <button type="button"  class="edit_btn btn btn-sm btn-outline-secondary"   onclick="minmax(this)"><input type="text"   class="border-0 text-center" value="{{data1.parameter_name}}" style="width: 85px;"  onclick="minmax(this)">
      </button>
      </div>  

         {% endfor %} 
       
      </div> 
      
      </div>
    </div>
    
    </div>
    </div>
            {% endfor %} 
    
 
     
     
  
      </div> 
    </div>
  <div class="logout_class"><a href="/logout"><img src="/static/images/enter.png"></a><span class="tooltiptext">Logout</span></div>
  </div>
</div>
    <!-- Optional JavaScript; choose one of the two! -->
<script src="https://code.jquery.com/jquery-3.7.0.min.js" integrity="sha256-2Pmvv0kuTBOenSvLm6bvfBSSHrUJ+3A7x6P5Ebd07/g=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.13.2/jquery-ui.min.js" integrity="sha512-57oZ/vW8ANMjR/KQ6Be9v/+/h6bq9/l3f0Oc7vn6qMqyhvPd1cvKBRWWpzu0QoneImqr2SkmO4MSqU+RpHom3Q==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <!-- Option 1: jQuery and Bootstrap Bundle (includes Popper) --> 
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-Fy6S3B9q64WdZWQUiU+q4/2Lc9npb8tCaSX9FK7E8HnRr0Jz8D6OP9dO5Vg3Q9ct" crossorigin="anonymous"></script>

 
  <script>$(document).ready(function() {
    var myChart123;
  var myChart124;
    var tabs = $("#container-1").tabs();
    var tabCounter = tabs.find('ul').first().children().length;
    var count = 0;
    $('#add_tab').click( function(){ 
        var ul = tabs.find( "ul" );
        $( '<li class="active"><a data-toggle="tab" href="#tabs'+ count +'">'+ $('#tab_in').val()+'</li>' ).appendTo( ul );
        $( '<div id="tabs'+ count +'" class="tab-pane fade in active" ><div class="text-center btn--m"><p class="m-0 new_text add_card">+ New Element</p></div><div class="row mt-2 main-content"></div></div>' ).appendTo( ".tab-content" );
        tabs.tabs( "refresh" );  
    count++;
      $("#staticBackdrop").modal('hide');
       <!-- tabs.tabs('select', tabCounter);-->
    
    });
   
  $(document).on("click", ".add_f" , function() {

    idval=$(this).parents(".main_item ").find("#fieldidmain").val()
    value=$(this).parents(".main_item ").find(".new_element").val()

    if(value == "")
    {
       alert("Please Enter value")
       
    }
     else{

       $( '<div class="hidden_edit">  <i class="pl-1 font12 fa fa-edit fa-btn-edit" ></i><i class="pl-1 font12 fa fa-trash icon-delete" onclick="deleteparam(this)"></i>       <button type="button"  class="edit_btn btn btn-sm btn-outline-secondary float-right" data-toggle="modal" onclick="minmax(this)"><input type="text" onclick="minmax(this)"  class="border-0 text-center" value="'+$(this).parent(".new_mn").children(".new_element").val()+'" style="width: 85px;">      </button>     </div>' ).appendTo (  $(this).parent(".new_mn").siblings(".tab-content-inn").children(".d-right").children(".btn_item")); 
       $(".new_element").val("");
      $.ajax({
            url: "/addnewparam",
            type: 'POST',
            data: {fieldtype: $("#fieldtype").val(),value:value,idval:idval},
               
           

               //data: { casename: caseName,filename: filenames} ,                   
              success: function(result){       
              }
            });


     }
    //$(".new_element").val("");

    });
  
    $('#show_popup').click(function(){
       $("#staticBackdrop").modal('show');
    });
    $('#show_popup1').click(function(){
       $("#traditional_m").modal('show');
    });
    
      $('#view_prop').click(function(){

        var prop_id = $('#fieldidmain').val();
        location.href = "/viewprop/"+prop_id;
  
         })
      $('#view_ten').click(function(){

        var prop_id = $('#fieldidmainten').val();
        location.href = "/viewten/"+prop_id;
  
         })
      $('#del_prop').click(function(){

        var prop_id = $('#fieldidmain').val();
        location.href = "/delprop/"+prop_id;
  
         })
      $('#del_ten').click(function(){

        var prop_id = $('#fieldidmainten').val();
        location.href = "/delten/"+prop_id;
  
         })
       
   

  $(document).on("click", "#add_prop_main" , function() { 

  if($("#tab_in_exp").val() == "")
  {
    alert("pls enter value")
  }
  else{


    $.ajax({
            url: "/add_property",
            type: 'POST',
            data: {p_name: $("#staticBackdrop #p_name").val(),address: $('#staticBackdrop #address').val(),location: $('#staticBackdrop #location').val(),u_name: $('#staticBackdrop #u_name').val(),rent_cost: $('#staticBackdrop #rent').val(),type: $('#staticBackdrop #type').val()},
               
           

               //data: { casename: caseName,filename: filenames} ,                   
              success: function(result){    
                alert(result.msg)           
             
               $( '<div class="col-md-4 mb-4 main_item "><div class="tab-content-mn"><div class="dropdown">        <i class="pl-1 font12 fa fa-ellipsis-v more_v " data-toggle="dropdown" aria-expanded="false"></i>       <ul class="dropdown-menu " aria-labelledby="navbarDropdownMenuLink">       <li class="dropdown-submenu"><a class="dropdown-item dropdown-toggle" href="#">View</a>                 </li>          <li><a class="dropdown-item edit_field" href="#" id="field_edit">Rename</a></li>          <li><a class="dropdown-item edit_field close_element" href="#" >Delete</a></li>     </ul>  </div>      <div class="tab-content-inn">     <div class="content-img"><p class="edit_p"><input type="text" disabled class="border-0 text-center" value="'+$(".pop_in").val()+'"></p></div>     <div class="d-grid d-right">       </div></div> </div>   </div>' ).appendTo(".expirimental_c"); $("#staticBackdrop").modal('hide');
    //<div class="new_mn">  <input type="text"  class="new_element" onfocus="this.value='+null+'"  ><button class="add_f btn btn-sm btn-warning">Add Element</button> </div>
    $(".pop_in").val("");

    
               
                 },
                


            });

  } 



    

  

      
   }); 
  $(document).on("click", "#add_prop" , function() { 

  if($("#tab_in_exp").val() == "")
  {
    alert("pls enter value")
  }
  else{


    $.ajax({
            url: "/add_property",
            type: 'POST',
            data: {p_name: $("#staticBackdropview #p_name").val(),address: $('#staticBackdropview #address').val(),location: $('#staticBackdropview  #location').val(),u_name: $('#staticBackdropview  #u_name').val(),id:$('#staticBackdropview #p_id').val(),type:$('#staticBackdropview #type').val(),rent:$('#staticBackdropview #rent').val(),v:'e'},
               
           

               //data: { casename: caseName,filename: filenames} ,                   
              success: function(result){    
                alert(result.msg)           
             
               $( '<div class="col-md-4 mb-4 main_item "><div class="tab-content-mn"><div class="dropdown">        <i class="pl-1 font12 fa fa-ellipsis-v more_v " data-toggle="dropdown" aria-expanded="false"></i>       <ul class="dropdown-menu " aria-labelledby="navbarDropdownMenuLink">       <li class="dropdown-submenu"><a class="dropdown-item dropdown-toggle" href="#">View</a>            <ul class="dropdown-menu ">              <li><a class="dropdown-item chart_field"   >Graph</a></li><li><a class="dropdown-item chart_field1"   data-toggle="modal" data-target="#chart1">Graph1</a></li><li><a class="dropdown-item table_field" >Table</a></li>       </ul>      </li>          <li><a class="dropdown-item edit_field" href="#" id="field_edit">Rename</a></li>          <li><a class="dropdown-item edit_field close_element" href="#" >Delete</a></li>     </ul>  </div>      <div class="tab-content-inn">     <div class="content-img"><p class="edit_p"><input type="text" disabled class="border-0 text-center" value="'+$(".pop_in").val()+'"></p></div>     <div class="d-grid d-right">       </div></div> </div>   </div>' ).appendTo(".expirimental_c"); $("#staticBackdropview").modal('hide');
    //<div class="new_mn">  <input type="text"  class="new_element" onfocus="this.value='+null+'"  ><button class="add_f btn btn-sm btn-warning">Add Element</button> </div>
    $(".pop_in").val("");

    
               
                 },
                


            });

  } 

    

  

      
   }); 
  $('#tenant_form').submit(function() {
    
  if($("#t_name").val() == "")
  {
    alert("pls enter value")
  }
  else{

  
    
    $form  = $(this)
    // Create a FormData object
    
    var formData = new FormData(this);
    
    // Append form data including the file
   
    $.ajax({
            url: "/add_tenant",
            type: 'POST',
            data: formData,
            processData: false,  // Important: Prevent jQuery from processing the data
            contentType: false,  // Important: Prevent jQuery from setting the content type
           

               //data: { casename: caseName,filename: filenames} ,                   
              success: function(result){   
                alert(result.msg)            
               
      $( '<div class="col-md-4 mb-4 main_item "><div class="tab-content-mn"><div class="dropdown">       <i class="pl-1 font12 fa fa-ellipsis-v more_v " data-toggle="dropdown" aria-expanded="false"></i>   <ul class="dropdown-menu " aria-labelledby="navbarDropdownMenuLink">       <li class="dropdown-submenu"><a class="dropdown-item dropdown-toggle" href="#">View</a>        <ul class="dropdown-menu ">             <li><a class="dropdown-item chart_field"   >Graph</a></li><li><a class="dropdown-item chart_field1"   data-toggle="modal" data-target="#chart1">Graph1</a></li> <li><a class="dropdown-item table_field"  >Table</a></li>             </ul>          </li>          <li><a class="dropdown-item edit_field" href="#" id="field_edit">Rename</a></li>          <li><a class="dropdown-item edit_field close_element" href="#" >Delete</a></li></ul> </div>  <div class="tab-content-inn">  <div class="content-img"><p class="edit_p"><input type="text" disabled class="border-0 text-center" value="'+$(".pop_in2").val()+'"></p></div>  <div class="d-grid d-right">   <div class="btn_item"> </div>   </div></div>    </div></div>' ).appendTo(".traditional_c"); $("#traditional_m").modal('hide');
      //<div class="new_mn">         <input type="text"  class="new_element" onfocus="this.value='+null+'"  > <button class="add_f btn btn-sm btn-warning">Add Element</button>   </div>
    

  }
});
  }
    }); 
   
   
  $(document).on("click", ".fa-btn-edit" , function() {  
   $(this).siblings("button").children("input").removeAttr("disabled");
   $(this).siblings("button").children("input").focus(); 
   $(this).siblings("button").removeAttr("data-toggle","modal");
   
  }); 
  var editid;
   $(document).on("click", "#edit_field" , function() { 


    editid=$(this).parents(".main_item ").find("#fieldidmain").val()
    //alert(editid)
    
   
    $(this).parents(".main_item ").find(".edit_p").children("input").removeAttr("disabled");  
    $(this).parents(".main_item ").find(".edit_p").children("input").focus(); 

  });   
   
  // $(document).on("click", ".icon-delete" , function() {   
   
 //   alert($(this).parents(".main_item ").find("#fieldidmain").val())
   
 //   alert($(this).parents(".main_item ").find(".edit_btn  input").val())
 //   $.ajax({
 //            url: "/deleteparams",
 //            type: 'POST',
 //            data: { ids:$(this).parents(".main_item ").find("#fieldidmain").val()},
             
           

 //               //data: { casename: caseName,filename: filenames} ,                   
 //              success: function(result){ 
 //                $(this).parents(".main_item ").remove(); 
 //              }
 //            });  
  
  
  // }); 



$(document).mouseup(function(e)
{
  var container = $(".edit_btn");
if (!container.is(e.target) && container.has(e.target).length === 0)
{ 
 // $(".edit_btn  input").attr("disabled","disabled");
    $(".edit_btn").attr("data-toggle","modal");
}
  }); 
  
$(document).mouseup(function(e)
{
  var container = $(".edit_p input");
if (!container.is(e.target) && container.has(e.target).length === 0)
{ 
  //$(".edit_p  input").attr("disabled","disabled"); 

  
  // $.ajax({
  //           url: "/renamefield",
  //           type: 'POST',
  //           data: { ids:editid,name:$(".edit_p  input").val()},
             
           

  //              //data: { casename: caseName,filename: filenames} ,                   
  //             success: function(result){ 
  //             }
  //           });

}
  }); 
 
 

  
  
//  const outsideClickListenerww = element => ({ target }) => {
 //if (!element.contains(target)) {
    
  // $(".edit_p  input").attr("disabled","disabled");   
  //}
//};
// const squareElww = document.getElementById("field_edit");
//document.addEventListener("click", outsideClickListenerww(squareElww));
  
     
 $(document).on("click", ".dropdown-menu a.dropdown-toggle" , function(e) {  
  if (!$(this).next().hasClass('show')) {
    $(this).parents('.dropdown-menu').first().find('.show').removeClass("show");
  }
  var $subMenu = $(this).next(".dropdown-menu");
  $subMenu.toggleClass('show');


  $(this).parents('li.nav-item.dropdown.show').on('hidden.bs.dropdown', function(e) {
    $('.dropdown-submenu .show').removeClass("show");
  });


  return false;
  
   
});

 $(document).on("click", ".dropdown-submenu .dropdown-menu .dropdown-item" , function(e) {  
       var $subMenu = $(".dropdown-submenu").children(".dropdown-menu");
  $subMenu.removeClass('show');
      
      });
  

//var xValues = ["Italy", "France", "Spain", "USA", "Argentina"];
xValues=['PH','Nitrogen','Phosphorus','Potassium','Soil Moisture','Conductivity','Temperature']
var yValues = [55, 49, 44, 24, 25];
var barColors = ["red", "green","blue","orange","brown","red", "green","blue","orange","brown"];
myChart123=new Chart("myChart", {
  type: "bar",
  data: {
    labels: xValues,
    datasets: [{
      label:"Min",
      backgroundColor: "green",
      data: yValues
    },
    {
      label:"Max",
      backgroundColor: "red",
      data: yValues
    }]
  },
  options: {
    tooltips: {
      displayColors: true,
      callbacks:{
        mode: 'x',
      },
    },
    scales: {
      xAxes: [{
        stacked: true,
        gridLines: {
          display: false,
        }
      }],
      yAxes: [{
        stacked: true,
        ticks: {
          beginAtZero: true,
        },
        type: 'linear',
      }]
    },
    responsive: true,
    maintainAspectRatio: false,
    legend: { position: 'bottom' },
  }
});

myChart124=new Chart("myChart1", {
  type: 'line',
                    data: {
                        //labels: ['Red', 'Blue', 'Yellow', 'Green', 'Purple', 'Orange'],
                        datasets: [{
                            label: 'Value',
                            //data: [12, 19, 3, 5, 2, 3],
                            fill: false,
    borderColor: 'rgb(75, 192, 192)',
    tension: 0.1
                        }]
                    },
                    options: {
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
  
});


$(document).on("click", ".table_field" , function() { 

  idval=$(this).parents(".main_item ").find("#fieldidmain").val()
    

  $("#table_popup").modal('show')

  $.ajax({
            url: "/gettabledata",
            type: 'POST',
            data: { ids:idval},
             
           

               //data: { casename: caseName,filename: filenames} ,                   
              success: function(result){ 
              data=result.getval

              paramvalue=result.paramvalue
            keyarry=[]
            header=Object.keys(data);
            
              var m='<thead>';
              for (const [key, value] of Object.entries(paramvalue))
              {
         for (const [key1, value1] of Object.entries(value))
              {

                if(key1 =="parameter_name")
                {
                  keyarry.push(value1)
                }
              }


                
              }

              
                for(var i=0;i<keyarry.length;i++)
                {
                  val=keyarry[i]+"_min_value"
                    
                   m+='<th >'+val+'</th>'
                   val1=keyarry[i]+"_max_value"
                    
                   m+='<th >'+val1+'</th>'
                 
                  
                }

         
              m+='</thead>'

m+='<tbody>'
             
               m+='<tr>'
                  for (const [key, value] of Object.entries(data))
              {

                for(var i=0;i<keyarry.length;i++)
                {
               if(key !== "field_id" && key !== "id" )
               {
                if(key.includes(keyarry[i]))
                m+='<td>'+value+' </td>'
               }

                }
              }

                m+='</tr>' 
              
               
               
              
               m+='</tbody>'
                  
 
  document.getElementById('valuetable').innerHTML = m;            
             
              
               
                 },
                


            });



});
$(document).on("click", ".chart_field1" , function() { 

  idval=$(this).parents(".main_item ").find("#fieldidmain").val()
    

  $("#chart1").modal('show')
   myChart124.data.labels=[]
              // myChart123.data.backgroundColor=barColors
               myChart124.data.datasets[0].data=[]
               myChart124.update()

  $.ajax({
            url: "/getnewdata",
            type: 'POST',
            data: { ids:idval},
              //data: { casename: caseName,filename: filenames} ,                   
              success: function(result){

                data=result.getval
                
               
               keyarry=Object.keys(data)
               itemsToRemove=["id", "plant_id","field_id","device_id"]
                const removeItems = (array, itemToRemove) => { 
  return array.filter(v => { 
      return !itemsToRemove.includes(v); 
    });
} 
          keyarry1=removeItems(keyarry, itemsToRemove);
             
               myChart124.data.labels=keyarry1
                for (const [key, value] of Object.entries(data))
              {
               if(key !== "field_id" && key !== "id" )
               {

                  //myChart123.data.labels.push(key);
                  
                     myChart124.data.datasets[0].data.push(value);
                   
                
                
                  myChart124.update()
               }
             }
             
            }
         
               
             
            
          
});

 
    
}); 


$(document).on("click", ".chart_field" , function() { 

  idval=$(this).parents(".main_item ").find("#fieldidmain").val()
    

  $("#chart").modal('show')

 myChart123.data.labels=[]
              // myChart123.data.backgroundColor=barColors
               myChart123.data.datasets[0].data=[]
                myChart123.data.datasets[1].data=[]
               myChart123.update()
  $.ajax({
            url: "/gettabledata",
            type: 'POST',
            data: { ids:idval},
              //data: { casename: caseName,filename: filenames} ,                   
              success: function(result){
                var barColors = ["red", "green","blue","orange","brown","red", "green","blue","orange","brown"];
           
               
                data=result.getval

               keyarry=Object.keys(data)
               somearry=[]
               for(var i=0;i<keyarry.length;i++)
               {
                if(keyarry[i] !== "field_id" && keyarry[i] !== "id" )
                {
                   if(keyarry[i].includes("_min_value") 
                    )
                   {
                    somearry.push(keyarry[i].replace('_min_value',''))
                    
                   }
                   else{
                    somearry.push(keyarry[i].replace('_max_value',''))
                   }
                   
                }
    

               }
                paramvalue=result.paramvalue
            keyarry1=[]
            
             
              for (const [key, value] of Object.entries(paramvalue))
              {
         for (const [key1, value1] of Object.entries(value))
              {

                if(key1 =="parameter_name")
                {
                  keyarry1.push(value1)
                }
              }


                
              }

        
               org= somearry.filter((item,
        index) => somearry.indexOf(item) === index);

               myChart123.data.labels=keyarry1
                for (const [key, value] of Object.entries(data))
              {
                 for(var i=0;i<keyarry1.length;i++)
                {

              
                if(key.includes(keyarry1[i]+"_min_value"))
                {
                  myChart123.data.datasets[0].data.push(value);
                }
                 if(key.includes(keyarry1[i]+"_max_value")){
                    myChart123.data.datasets[1].data.push(value);
                }
                 myChart123.update()
               
              

                }
              }
               
                
            }     
           });  
             
       
});

 
    
}); 
function deleteparam(ctl) 
{
  idmainval=$(ctl).parents(".tab-content-inn ").find("#fieldidmain").val()
 textval=$(ctl).siblings("button").children("input").val()

 $.ajax({
            url: "/deleteparam",
            type: 'POST',
            data: { ids:idmainval,name:textval,fieldtype: $("#fieldtype").val()},
             
           

               //data: { casename: caseName,filename: filenames} ,                   
              success: function(result){ 
                location.href="/"
                $(this).parents(".main_item ").remove(); 
              }
            });  
  


} 
function minmax(ctl)
{ 

 
 idmainval=$(ctl).parents(".tab-content-inn ").find("#fieldidmain").val()
 textval=$(ctl).find("input").val()


  $("#min_max").modal('show')
    $("#fieldid").val(idmainval)
  $("#fieldvaluetype").val(textval)
var formData = new FormData();

    ;
   formData.append("fieldid",idmainval) 
   formData.append("fieldvalue",textval) 
   $.ajax({
            url: "/getvalue",
            type: 'POST',
            data: formData,
               cache: false,
            contentType: false,
            processData: false,
           

               //data: { casename: caseName,filename: filenames} ,                   
              success: function(result){  
              data=result.getval           
              for (const [key, value] of Object.entries(data))
              {
               for (const [key1, value1] of Object.entries(value))
              {
              
               if(key1 !== "field_id" && key1 !== "id" )
               {
                if(key1.includes(textval+"_min_value"))
                {


                    $("#minvalue").val(value1)
              
                }
                if(key1.includes(textval+"_max_value"))
                {


                    $("#maxvalue").val(value1)
              
                }
                
               

                }
              }
            }

              
               
                 },
                


            });
}

$('#addminmax').submit(function(e){
   e.preventDefault();
  $form = $(this)
        var formData = new FormData(this);

    ;
   $.ajax({
            url: "/addminmax",
            type: 'POST',
            data: formData,
               cache: false,
            contentType: false,
            processData: false,
           

               //data: { casename: caseName,filename: filenames} ,                   
              success: function(result){               
             
               $("#min_max").modal('hide')
               
                 },
                


            });

  
      
 
});


</script>
 
  </body>
</html>